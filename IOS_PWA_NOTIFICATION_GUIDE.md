# iOS PWA 푸시 알림 설정 가이드

## iOS PWA 알림 제한사항

iOS에서 PWA 푸시 알림은 **제한적**입니다:

1. **iOS 16.4+** 이상에서만 지원
2. 앱이 **완전히 종료되면 알림을 받을 수 없음** (iOS 제한)
3. 앱이 **백그라운드에 있어야** 알림을 받을 수 있음
4. Service Worker가 활성화되어 있어야 함

## 설정 방법

### 1. 알림 권한 요청 (가장 중요!)

**iOS PWA에서는 앱 내에서 직접 알림 권한을 요청해야 합니다:**

1. **PWA 앱 실행**
   - 홈 화면에서 PWA 앱 아이콘 탭
   - (Safari에서 열면 안 됩니다! 홈 화면에 추가한 앱으로 열어야 합니다)

2. **설정 모달 열기**
   - 우측 상단 **설정 아이콘** (톱니바퀴) 클릭

3. **알림 활성화**
   - **"알림 활성화"** 버튼 클릭
   - iOS에서 알림 권한 요청 팝업이 나타나면 **"허용"** 클릭

4. **확인**
   - 버튼이 **"알림 활성화됨"**으로 변경되면 성공!

### 2. iOS 설정 확인 (선택사항)

**참고**: iOS 16.4+에서는 PWA 앱이 독립적으로 작동하므로, Safari 설정에서 별도로 설정할 필요가 없습니다. **앱 내에서 직접 권한을 요청**하는 것이 가장 중요합니다.

만약 권한이 거부된 경우:
1. PWA 앱 삭제 (홈 화면에서 길게 누르고 삭제)
2. Safari에서 사이트 다시 열기
3. 공유 버튼 > **"홈 화면에 추가"** 다시 실행
4. 앱 내에서 알림 권한 다시 요청

### 3. PWA 재설치 (필요시)

알림이 작동하지 않으면:

1. 홈 화면에서 PWA 앱 삭제
2. Safari에서 사이트 다시 열기
3. 공유 버튼 > **"홈 화면에 추가"** 다시 실행
4. 알림 권한 다시 요청

## 테스트 방법

### 1. 기본 테스트

1. 두 개의 기기 준비 (또는 다른 사용자)
2. 각각 PWA 앱 설치 및 알림 권한 허용
3. 같은 방에서 메시지 전송
4. **앱이 백그라운드에 있을 때** 알림 확인

### 2. 백그라운드 테스트

1. PWA 앱 실행
2. 알림 권한 허용
3. **앱을 백그라운드로 전환** (홈 버튼 누르기)
4. 다른 사용자가 메시지 전송
5. 알림 확인

### 3. 알림 클릭 테스트

1. 알림 수신
2. 알림 클릭
3. 앱이 열리고 해당 방으로 이동하는지 확인

## 문제 해결

### 알림이 오지 않는 경우

1. **앱이 완전히 종료되었는지 확인**
   - iOS에서는 앱이 완전히 종료되면 알림을 받을 수 없습니다
   - 앱을 백그라운드로만 전환해야 합니다 (홈 화면으로 나가기만 하면 됨)
   - 앱을 위로 스와이프하여 완전히 종료하지 마세요

2. **알림 권한 확인**
   - PWA 앱 내에서 설정 모달 열기
   - 알림 권한 상태 확인
   - "알림 활성화" 버튼이 보이면 클릭하여 권한 요청
   - 브라우저에서 알림 권한 팝업이 나타나면 "허용" 클릭

3. **PWA 재설치 (필요시)**
   - 홈 화면에서 PWA 앱 삭제
   - Safari에서 사이트 다시 열기
   - 공유 버튼 > "홈 화면에 추가" 다시 실행
   - 알림 권한 다시 요청

3. **Service Worker 확인**
   - 브라우저 개발자 도구 > Application > Service Workers
   - Service Worker가 활성화되어 있는지 확인

4. **앱이 포커스되어 있는지 확인**
   - 현재 방을 보고 있으면 알림이 표시되지 않습니다
   - 다른 방의 메시지만 알림으로 표시됩니다

### 알림은 오지만 클릭해도 앱이 안 열리는 경우

1. PWA 앱이 홈 화면에 제대로 설치되어 있는지 확인
2. Service Worker가 활성화되어 있는지 확인
3. 브라우저 캐시 삭제 후 재설치

## 현재 구현 상태

✅ **구현 완료:**
- Service Worker를 통한 알림 표시
- 백그라운드에서도 알림 수신 (앱이 완전히 종료되지 않은 경우)
- 알림 클릭 시 해당 방으로 이동
- 현재 방의 메시지는 알림 스킵 (중복 방지)

⚠️ **iOS 제한사항:**
- 앱이 완전히 종료되면 알림을 받을 수 없음
- iOS 16.4+ 이상에서만 지원
- 백그라운드에서만 작동

## 추가 개선 가능 사항

향후 필요시:
- Web Push API를 통한 서버 측 푸시 (더 안정적이지만 서버 필요)
- Firebase Cloud Messaging (FCM) 통합
- Native 앱으로 전환 (완전한 푸시 알림 지원)

